using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using UnityEngine.UI;
public class SwipeUI : MonoBehaviour
{
    [SerializeField]
    private Scrollbar scrollbar; //Scrollbar???è¢â‘º????„ì…?æº??ê³—ì¨® ?è¢â‘¹????ë¥ëµ ç­Œì™–? ?êºœ???
    [SerializeField]
    private float swipeTime = 0.2f; //??ë¥ëµ ç­Œì™–??¶ì›? swipe ??ë¡«ë®‰ ??ë³?¢
    [SerializeField]
    private float swipeDistance = 50.0f;//??ë¥ëµ ç­Œì™–??¶ì›? swipe???¾â”› ?è¢ã‚‹????ç­ŒìšŠ????ç­Œã…¼ë®??æ¤°ê¾§???

    private float[] scrollPageValues; //????ë¥ëµ ç­Œì™–????è¢â‘º????0.0 ~ 1.0]
    private float valueDistance = 0;//????ë¥ëµ ç­Œì™–? ?????æ¤°ê¾§???
    private int currentPage = 0;//?è¢â‘¹????ë¥ëµ ç­Œì™–?
    private int maxPage = 0;//ç­Œã…¼ë®? ??ë¥ëµ ç­Œì™–?
    private float startTouchx;//??¨ì€?’„ ??ë½°ì‚‚ ?è¢â‘º??
    private float endTouchx; // ??¨ì€?’„ ??«êµï§??è¢â‘º??
    private bool isSwipeMode = false;//?è¢â‘¹??swipe?¶ì›? ???Â€????ˆë®‰ç­Œì™–? ç­Œï½‹?¾å¯ƒ?

    private void Awake()
    {
        //???„ì¾¿????ë¡«ë®‰ ??ë¥ëµ ç­Œì™–?????value ?¶ì…??????é¤¨é‡‰???„ì„?£è‚‰?ç­Œë¡«?€??„ëµ³???«ë”…ë¼?
        scrollPageValues = new float[transform.childCount];

        //???„ì¾¿????ë¡«ë®‰ ??ë¥ëµ ç­Œì™–? ?????æ¤°ê¾§???
        valueDistance = 1f / (scrollPageValues.Length - 1f);

        //???„ì¾¿????ë¡«ë®‰ ??ë¥ëµ ç­Œì™–?????value ?è¢â‘º?????±ì Ÿ [0 <= value <= 1]
        for(int i=0;i<scrollPageValues.Length;--i)
        {
            scrollPageValues[i] = valueDistance * i;
        }
        //ç­Œã…¼ë®? ??ë¥ëµ ç­Œì™–?????
        maxPage = transform.childCount;

    }

    private void Start()
    {
        //ç­Œã…¼ë®????ë½°ì‚‚????0????ë¥ëµ ç­Œì™–??????????ˆì¦²?????±ì Ÿ
        SetScrollBarValue(0);
    }

    public void SetScrollBarValue(int index)
    {
        currentPage = index;
        scrollbar.value = scrollPageValues[index];
    }

    private void UpdateInput()
    {
        //?è¢â‘¹??swipe??ç­ŒìšŠ?µï§‘?Œë¹³?¾ë?ëµ ç­Œ???¨ì€?’„ ?ë¸ëœƒ?
        if (isSwipeMode == true) return;
        
        if(Input.GetKeyDown(KeyCode.Mouse0))
        {
            //???°ë»» ??ë½°ì‚‚ ç­Œì™–???(Swipe ?„ì»ë«šå ‰???Œë²??
            startTouchx = Input.mousePosition.x;
        }
        else if(Input.GetMouseButtonDown(0))
        {
            //??¨ì€?’„ é¤“Î»ìµ??ç­Œì™–???
            endTouchx = Input.mousePosition.x;

            UpdateInput();
        }
    }

    private void UpdateSwipe()
    {
        //??????? æ¤°ê¾§??ê³?ª´???ç­ŒìšŠ???????ë®?Swpie X
        if(Mathf.Abs(startTouchx-endTouchx)<swipeDistance)
        {
            //???????ë¥ëµ ç­Œì™–???Swipe??ê³´í£ ????¡æ¶?„ì‘¬??
            StartCoroutine(OnSwipeOneStep(currentPage));
            return;
        }
        //swipe ?„ì»ë«šå ‰?
        bool isLeft = startTouchx < endTouchx ? true : false;

        //??????„ì»ë«šå ‰????ê¸±ê±¹????
        if(isLeft==true)
        {
            //?è¢â‘¹????ë¥ëµ ç­Œì™–??¶ì›? ??ê¸±ê±¹ ??ë±€ëµ ç­Œ???«êµï§?
            if (currentPage == 0) return;
            //??ê¸±ê±¹??ê³—ì¨® ???????è¢ã‚‹???è¢â‘¹????ë¥ëµ ç­Œì™–???1 ?¶ì…ÅŠ??
            currentPage--;
        }
        //??????„ì»ë«šå ‰?????˜ë€²ç­Œ?›ëŸ©????
        else
        {
            //?è¢â‘¹????ë¥ëµ ç­Œì™–??¶ì›? ???˜ë€²ç­Œ???ë±€ëµ ç­Œ???«êµï§?
            if (currentPage == maxPage - 1) return;
            //???˜ë€²ç­Œ?›ëŸ©???—????????è¢ã‚‹???è¢â‘¹????ë¥ëµ ç­Œì™–???1 ç­Œì•¹ë¹?
            currentPage++;
        }
        //currentIndex?•ê³•?????ë¥ëµ ç­Œì™–???Swipe??ê³´í£ ?????
        StartCoroutine(OnSwipeOneStep(currentPage));
    }
    //??ë¥ëµ ç­Œì™–?????????ê³¸ëªµ?????¾â”›??swipe ??ï½‹ê¶¢ ??æº?
    private IEnumerator OnSwipeOneStep(int index)
    {
        float start = scrollbar.value;
        float current = 0;
        float percent = 0;
        isSwipeMode = true;
        while(percent<1)
        {
            current += Time.deltaTime;
            percent = current / swipeTime;
            scrollbar.value = Mathf.Lerp(start, scrollPageValues[index], percent);
            yield return null;
        }
        isSwipeMode = false;
    }
}
